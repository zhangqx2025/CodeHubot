# è·¯ç”±é¡ºåºä¿®å¤ - å®Œæˆæ€»ç»“

## ğŸ› é—®é¢˜æè¿°

å‰ç«¯è°ƒç”¨ `/pbl/admin/schools/my-school/statistics` æ—¶ï¼Œåç«¯æ—¥å¿—æ˜¾ç¤ºï¼š

```log
WARNING: ğŸ”’ å®‰å…¨æ‹¦æˆª - å­¦æ ¡ç®¡ç†å‘˜ admin@CC-DEZX å°è¯•è®¿é—®å…¶ä»–å­¦æ ¡UUID (my-school)ï¼Œ
å·²è‡ªåŠ¨é‡å®šå‘åˆ°å…¶æ‰€å±å­¦æ ¡ é•¿æ˜¥å¸‚ç¬¬äºŒä¸­å­¦ (uuid=a54ef548-7ff7-4358-bfbe-14d2aa93cf40)
```

## ğŸ” é—®é¢˜åŸå› 

**FastAPIçš„è·¯ç”±åŒ¹é…æ˜¯æŒ‰æ³¨å†Œé¡ºåºè¿›è¡Œçš„**ï¼Œå…·ä½“è·¯å¾„å¿…é¡»åœ¨é€šç”¨è·¯å¾„ä¹‹å‰æ³¨å†Œã€‚

### ä¿®å¤å‰çš„è·¯ç”±é¡ºåºï¼ˆâŒ é”™è¯¯ï¼‰

```python
ç¬¬117è¡Œ:  /{school_uuid}              â† é€šç”¨è·¯å¾„åœ¨å‰
ç¬¬818è¡Œ:  /{school_uuid}/users         â† é€šç”¨è·¯å¾„åœ¨å‰
ç¬¬924è¡Œ:  /my-school/info              â† å…·ä½“è·¯å¾„åœ¨å âŒ
ç¬¬970è¡Œ:  /my-school/users             â† å…·ä½“è·¯å¾„åœ¨å âŒ
ç¬¬1062è¡Œ: /my-school/statistics        â† å…·ä½“è·¯å¾„åœ¨å âŒ
ç¬¬1130è¡Œ: /{school_uuid}/statistics    â† é€šç”¨è·¯å¾„åœ¨å
```

**é—®é¢˜ï¼š**
å½“è¯·æ±‚ `/my-school/statistics` æ—¶ï¼ŒFastAPI å…ˆåŒ¹é…åˆ° `/{school_uuid}`ï¼ŒæŠŠ `my-school` å½“æˆäº† `school_uuid` å‚æ•°çš„å€¼ï¼Œå¯¼è‡´è§¦å‘äº†å®‰å…¨æ‹¦æˆªé€»è¾‘ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤åçš„è·¯ç”±é¡ºåºï¼ˆâœ… æ­£ç¡®ï¼‰

```python
ç¬¬24è¡Œ:   /list                       â† æœ€å…·ä½“
ç¬¬121è¡Œ:  /my-school/info              â† å…·ä½“è·¯å¾„ âœ…
ç¬¬167è¡Œ:  /my-school/users             â† å…·ä½“è·¯å¾„ âœ…
ç¬¬259è¡Œ:  /my-school/statistics        â† å…·ä½“è·¯å¾„ âœ…
ç¬¬331è¡Œ:  /{school_uuid}               â† é€šç”¨è·¯å¾„ï¼ˆåœ¨æœ€åï¼‰
ç¬¬1026è¡Œ: /{school_uuid}/users         â† é€šç”¨è·¯å¾„
ç¬¬1128è¡Œ: /{school_uuid}/statistics    â† é€šç”¨è·¯å¾„
```

**ç°åœ¨çš„åŒ¹é…é€»è¾‘ï¼š**
1. è¯·æ±‚ `/my-school/statistics`
2. FastAPI å…ˆå°è¯•åŒ¹é… `/my-school/statistics` âœ… åŒ¹é…æˆåŠŸï¼
3. ç›´æ¥è°ƒç”¨ `get_my_school_statistics()` å‡½æ•°
4. ä¸ä¼šå†è§¦å‘å®‰å…¨æ‹¦æˆª

## ğŸ› ï¸ ä¿®æ”¹å†…å®¹

### 1. ç§»åŠ¨è·¯ç”±ä½ç½®

å°†ä¸‰ä¸ª `/my-school/*` è·¯ç”±ä»æ–‡ä»¶æœ«å°¾ç§»åŠ¨åˆ° `/{school_uuid}` è·¯ç”±ä¹‹å‰ï¼š

- âœ… `/my-school/info`
- âœ… `/my-school/users`
- âœ… `/my-school/statistics`

### 2. åˆ é™¤é‡å¤ä»£ç 

åˆ é™¤äº†åŸæ¥åœ¨æ–‡ä»¶æœ«å°¾çš„é‡å¤è·¯ç”±å®šä¹‰ï¼ˆç¬¬924-1342è¡Œï¼‰ã€‚

### 3. æ·»åŠ æ³¨é‡Šè¯´æ˜

```python
# ============================================================================
# ä¾¿æ·API - æ— éœ€ä¼ é€’UUIDï¼ˆå¿…é¡»åœ¨ /{school_uuid} è·¯ç”±ä¹‹å‰ï¼‰
# ============================================================================

@router.get("/my-school/info")
...

@router.get("/my-school/users")
...

@router.get("/my-school/statistics")
...


# ============================================================================
# å¸¦UUIDçš„API - ç”¨äºå¹³å°ç®¡ç†å‘˜æˆ–å…¼å®¹æ—§ä»£ç 
# ============================================================================

@router.get("/{school_uuid}")
...
```

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰

```
è¯·æ±‚: GET /pbl/admin/schools/my-school/statistics
  â†“
åŒ¹é…åˆ°: /{school_uuid}/statistics
  â†“
å‚æ•°: school_uuid = "my-school"
  â†“
è§¦å‘: ğŸ”’ å®‰å…¨æ‹¦æˆªè­¦å‘Š
  â†“
è‡ªåŠ¨é‡å®šå‘åˆ°æ­£ç¡®çš„å­¦æ ¡
```

### ä¿®å¤å

```
è¯·æ±‚: GET /pbl/admin/schools/my-school/statistics
  â†“
åŒ¹é…åˆ°: /my-school/statistics âœ…
  â†“
ç›´æ¥: è°ƒç”¨ get_my_school_statistics()
  â†“
æ— è­¦å‘Š: æ­£å¸¸è¿”å›æ•°æ®
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•å‘½ä»¤

```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend && uvicorn main:app --reload

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•ï¼ˆéœ€è¦å…ˆè·å–tokenï¼‰
curl -X GET "http://localhost:8000/api/pbl/admin/schools/my-school/statistics" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### é¢„æœŸç»“æœ

**ä¿®å¤å‰ï¼š**
```log
WARNING: ğŸ”’ å®‰å…¨æ‹¦æˆª - å­¦æ ¡ç®¡ç†å‘˜ xxx å°è¯•è®¿é—®å…¶ä»–å­¦æ ¡UUID (my-school)
```

**ä¿®å¤åï¼š**
```log
INFO: ç®¡ç†å‘˜ admin@CC-DEZX æŸ¥è¯¢è‡ªå·±å­¦æ ¡ é•¿æ˜¥å¸‚ç¬¬äºŒä¸­å­¦ çš„ç»Ÿè®¡ä¿¡æ¯
INFO: 127.0.0.1:55748 - "GET /api/pbl/admin/schools/my-school/statistics HTTP/1.1" 200 OK
```

âœ… **æ— å®‰å…¨æ‹¦æˆªè­¦å‘Š**

## ğŸ“ FastAPIè·¯ç”±åŒ¹é…è§„åˆ™

### é‡è¦åŸåˆ™

1. **æ›´å…·ä½“çš„è·¯ç”±å¿…é¡»åœ¨æ›´é€šç”¨çš„è·¯ç”±ä¹‹å‰æ³¨å†Œ**
2. FastAPIæŒ‰ç…§æ³¨å†Œé¡ºåºä¾æ¬¡å°è¯•åŒ¹é…
3. ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œå°±ä¸ä¼šç»§ç»­å°è¯•åé¢çš„è·¯ç”±

### æ­£ç¡®çš„é¡ºåºç¤ºä¾‹

```python
# âœ… æ­£ç¡®
@router.get("/users/me")          # æœ€å…·ä½“
@router.get("/users/{user_id}")   # é€šç”¨

# âŒ é”™è¯¯
@router.get("/users/{user_id}")   # é€šç”¨åœ¨å‰
@router.get("/users/me")          # å…·ä½“åœ¨åï¼ˆæ°¸è¿œä¸ä¼šè¢«åŒ¹é…åˆ°ï¼‰
```

### ä¸ºä»€ä¹ˆï¼Ÿ

```python
# å½“è¯·æ±‚ /users/me æ—¶ï¼š

# æ­£ç¡®é¡ºåºï¼š
1. å°è¯•åŒ¹é… /users/me âœ… æˆåŠŸ
2. ä¸å†ç»§ç»­åŒ¹é…

# é”™è¯¯é¡ºåºï¼š
1. å°è¯•åŒ¹é… /users/{user_id} âœ… æˆåŠŸï¼ˆuser_id="me"ï¼‰
2. /users/me æ°¸è¿œä¸ä¼šè¢«åŒ¹é…åˆ°
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è·¯ç”±ç»„ç»‡åŸåˆ™

```python
# æ¨èçš„è·¯ç”±é¡ºåº
@router.get("/list")                    # 1. å›ºå®šè·¯å¾„
@router.get("/my-resource")             # 2. ç‰¹å®šèµ„æº
@router.get("/my-resource/stats")       # 3. ç‰¹å®šèµ„æºçš„å­è·¯å¾„
@router.get("/{resource_id}")           # 4. åŠ¨æ€å‚æ•°
@router.get("/{resource_id}/details")   # 5. åŠ¨æ€å‚æ•°çš„å­è·¯å¾„
```

### 2. æ·»åŠ æ¸…æ™°çš„æ³¨é‡Š

```python
# ============================================================================
# ä¾¿æ·API - æ— éœ€å‚æ•°
# ============================================================================
@router.get("/my-school/info")
...

# ============================================================================
# é€šç”¨API - éœ€è¦å‚æ•°
# ============================================================================
@router.get("/{school_uuid}")
...
```

### 3. é¿å…è·¯ç”±å†²çª

- ä½¿ç”¨æ˜ç¡®çš„å‰ç¼€ï¼ˆå¦‚ `/my-`ï¼‰åŒºåˆ†ä¾¿æ·API
- é€šç”¨è·¯å¾„å‚æ•°ä½¿ç”¨æè¿°æ€§åç§°ï¼ˆå¦‚ `{school_uuid}` è€Œä¸æ˜¯ `{id}`ï¼‰
- é¿å…ä½¿ç”¨å¯èƒ½å†²çªçš„è·¯å¾„åç§°

## ğŸ‰ æ€»ç»“

### é—®é¢˜
- âœ… ä¿®å¤äº†è·¯ç”±åŒ¹é…é¡ºåºé”™è¯¯
- âœ… æ¶ˆé™¤äº†ä¸å¿…è¦çš„å®‰å…¨æ‹¦æˆªè­¦å‘Š
- âœ… åˆ é™¤äº†é‡å¤çš„è·¯ç”±å®šä¹‰

### æ”¹è¿›
- âœ… è·¯ç”±æŒ‰ç…§ä»å…·ä½“åˆ°é€šç”¨çš„é¡ºåºç»„ç»‡
- âœ… æ·»åŠ äº†æ¸…æ™°çš„æ³¨é‡Šåˆ†éš”ä¸åŒç±»å‹çš„API
- âœ… ä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤

### æ•ˆæœ
- âœ… å‰ç«¯è°ƒç”¨ `/my-school/*` API æ­£å¸¸å·¥ä½œ
- âœ… æ— å®‰å…¨æ‹¦æˆªè­¦å‘Š
- âœ… APIå“åº”æ›´å¿«ï¼ˆä¸éœ€è¦é‡å®šå‘ï¼‰

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2024å¹´12æœˆ22æ—¥  
**ä¿®å¤åŸåˆ™ï¼š** å…·ä½“è·¯å¾„ä¼˜å…ˆï¼Œé€šç”¨è·¯å¾„é å  
**æ–‡ä»¶ï¼š** `backend/app/api/pbl/schools.py`

