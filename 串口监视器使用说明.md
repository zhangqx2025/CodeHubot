# 串口监视器使用说明

## 📟 功能简介

串口监视器是一个基于浏览器的串口调试工具，可以实时查看和调试ESP32等设备的串口通信数据。

### ✨ 主要特点

- ✅ **完整支持中文**：可正确显示和发送中文字符
- ✅ **实时监控**：实时显示设备发送的数据
- ✅ **数据发送**：支持向设备发送命令和数据
- ✅ **十六进制模式**：可切换显示十六进制数据
- ✅ **时间戳显示**：每行数据显示精确到毫秒的时间戳
- ✅ **快捷命令**：支持自定义常用命令快捷按钮
- ✅ **多波特率支持**：支持从 9600 到 921600 多种波特率
- ✅ **数据统计**：实时显示接收行数、字节数和速率

## 🔧 环境要求

### 1. 浏览器要求

- **Chrome** (版本 ≥ 89)
- **Edge** (版本 ≥ 89)
- **Opera** (版本 ≥ 75)

❌ **不支持**：Firefox、Safari

### 2. 协议要求

**必须使用 HTTPS 访问**（或在 localhost 运行）

```
✅ https://your-domain.com
✅ http://localhost:3000
✅ http://127.0.0.1:3000
❌ http://192.168.1.100:3000  (局域网 IP 需要 HTTPS)
```

如果看到"浏览器不支持 Web Serial API"的错误，99% 是因为没有使用 HTTPS。

参考 [固件烧录功能_常见问题.md](./固件烧录功能_常见问题.md) 配置 HTTPS。

### 3. 硬件要求

- USB 数据线（非充电线）
- ESP32 或其他支持串口的设备

## 📖 使用步骤

### 第一步：打开串口监视器

1. 登录系统
2. 进入"设备管理"模块
3. 点击左侧菜单的"串口监视器"

### 第二步：配置串口参数

在连接设备之前，先设置串口参数：

#### 基础设置

- **波特率**：选择与设备匹配的波特率
  - 常用值：115200（ESP32 默认）
  - 其他选项：9600, 19200, 38400, 57600, 230400, 460800, 921600

#### 高级设置（通常使用默认值即可）

- **数据位**：通常选择 8
- **停止位**：通常选择 1
- **校验位**：通常选择"无"
- **字符编码**：
  - UTF-8（推荐，支持中文）
  - GBK（部分老设备）
  - ASCII（仅英文数字）

### 第三步：连接设备

1. 使用 USB 数据线将设备连接到电脑
2. 点击"连接设备"按钮
3. 在弹出的串口选择对话框中，选择对应的串口
   - 通常显示为：`USB-SERIAL CH340 (COM3)` 或类似名称
4. 点击"连接"

连接成功后，状态指示器会变为绿色，显示"已连接"。

### 第四步：查看数据

连接成功后，设备发送的所有数据都会实时显示在"接收数据"区域。

#### 显示选项

- **自动滚动**：开启后自动滚动到最新数据（推荐开启）
- **显示时间戳**：每行数据前显示接收时间
- **十六进制**：以十六进制格式显示数据（调试二进制协议时使用）

示例输出：

```
14:32:15.123  设备已启动
14:32:15.456  温度：25.3℃
14:32:15.789  湿度：60.5%
14:32:16.012  传感器状态：正常
```

#### 数据统计

底部状态栏实时显示：
- **接收行数**：已接收的数据行数
- **接收字节**：已接收的总字节数
- **速率**：当前数据接收速率（字节/秒）

### 第五步：发送数据

#### 方式一：输入框发送

1. 在"发送数据"区域的输入框中输入内容（支持中文）
2. 选择行尾符（通常选择"回车换行 \r\n"）
3. 点击"发送"按钮或按 Enter 键

示例：
```
输入：get_status
发送后设备收到：get_status\r\n
```

#### 方式二：快捷命令

点击预设的快捷命令按钮，快速发送常用命令。

默认提供的快捷命令：
- **获取状态**：发送 `status`
- **重启设备**：发送 `restart`
- **获取版本**：发送 `version`

#### 添加自定义快捷命令

1. 点击"添加"按钮
2. 输入命令名称（例如：打开LED）
3. 输入命令内容（例如：led on）
4. 点击"确定"

自定义的快捷命令会保存在浏览器本地存储中，下次打开仍然可用。

### 第六步：断开连接

使用完毕后，点击"断开连接"按钮断开串口。

## 💡 使用技巧

### 1. 中文显示异常？

确保：
- 字符编码设置为 **UTF-8**
- 设备端代码使用 UTF-8 编码发送中文

ESP32 Arduino 示例：
```cpp
Serial.begin(115200);
Serial.println("你好，世界！");  // 确保源代码保存为 UTF-8
```

### 2. 数据太多导致卡顿？

在"高级设置"中调整"最大缓冲行数"：
- 默认：1000 行
- 如果需要保留更多历史数据：增大到 5000-10000
- 如果出现卡顿：减小到 500 或更少

### 3. 快速清空数据

点击"接收数据"标题栏右侧的"清空"按钮，可快速清空所有接收数据。

### 4. 调试二进制协议

开启"十六进制"模式，数据将以十六进制显示：

```
普通模式：Hello
十六进制模式：48 65 6C 6C 6F
```

### 5. 导出日志数据

1. 选中"接收数据"区域的文本
2. 右键 -> 复制
3. 粘贴到文本编辑器保存

## 🔍 常见问题

### Q1: 提示"浏览器不支持 Web Serial API"

**原因**：未使用 HTTPS 协议

**解决方案**：
1. 如果在本地开发：使用 `localhost` 或 `127.0.0.1` 访问
2. 如果在服务器：配置 HTTPS 证书
3. 详细说明见：[固件烧录功能_常见问题.md](./固件烧录功能_常见问题.md)

### Q2: 找不到串口设备

**可能原因**：
1. 设备未正确连接
2. USB 线是充电线（不支持数据传输）
3. 缺少驱动程序

**解决方案**：
1. 检查 USB 连接，确保使用数据线
2. 安装 CH340 或 CP210x 驱动程序
3. 在设备管理器中查看串口是否被识别

### Q3: 接收到乱码

**可能原因**：
1. 波特率不匹配
2. 字符编码不对

**解决方案**：
1. 调整波特率，尝试常用值（115200、9600）
2. 切换字符编码（UTF-8、GBK、ASCII）

### Q4: 中文显示为问号或乱码

**解决方案**：
1. 确保字符编码设置为 **UTF-8**
2. 确保设备端代码：
   - 源文件保存为 UTF-8 编码
   - 串口输出使用 UTF-8 编码

### Q5: 无法发送中文

**解决方案**：
1. 确保字符编码设置为 **UTF-8**
2. 确保设备端支持接收 UTF-8 编码的中文

ESP32 示例：
```cpp
String received = Serial.readString();
Serial.println("收到：" + received);  // 可正确处理中文
```

### Q6: 数据接收速度慢

**可能原因**：
1. 设备发送间隔较长
2. 波特率较低

**解决方案**：
1. 查看底部状态栏的"速率"，确认实际接收速度
2. 如需更高速率，尝试提高波特率（如 230400、460800）

### Q7: 已经连接但收不到数据

**排查步骤**：
1. 检查设备是否正常运行（LED 指示等）
2. 确认设备代码中有 `Serial.print()` 或类似输出
3. 尝试重启设备
4. 尝试断开重连
5. 检查波特率是否匹配

## 📝 ESP32 示例代码

### 基础示例

```cpp
void setup() {
  // 初始化串口，波特率 115200
  Serial.begin(115200);
  Serial.println("系统启动");
  Serial.println("支持中文输出");
}

void loop() {
  // 输出传感器数据
  float temp = 25.5;
  float humi = 60.3;
  
  Serial.print("温度：");
  Serial.print(temp);
  Serial.println("℃");
  
  Serial.print("湿度：");
  Serial.print(humi);
  Serial.println("%");
  
  delay(1000);
}
```

### 接收命令示例

```cpp
void setup() {
  Serial.begin(115200);
  Serial.println("命令行界面已就绪");
  Serial.println("支持命令：status, restart, led on/off");
}

void loop() {
  if (Serial.available() > 0) {
    String cmd = Serial.readStringUntil('\n');
    cmd.trim();  // 去除空格和换行符
    
    if (cmd == "status") {
      Serial.println("状态：运行中");
      Serial.println("运行时间：" + String(millis()) + "ms");
    }
    else if (cmd == "restart") {
      Serial.println("正在重启...");
      delay(100);
      ESP.restart();
    }
    else if (cmd == "led on") {
      digitalWrite(LED_BUILTIN, HIGH);
      Serial.println("LED 已打开");
    }
    else if (cmd == "led off") {
      digitalWrite(LED_BUILTIN, LOW);
      Serial.println("LED 已关闭");
    }
    else {
      Serial.println("未知命令：" + cmd);
    }
  }
}
```

### 中文交互示例

```cpp
void setup() {
  Serial.begin(115200);
  Serial.println("欢迎使用智能设备");
  Serial.println("请输入命令：");
  Serial.println("  查询 - 查询设备状态");
  Serial.println("  开灯 - 打开LED");
  Serial.println("  关灯 - 关闭LED");
}

void loop() {
  if (Serial.available() > 0) {
    String cmd = Serial.readStringUntil('\n');
    cmd.trim();
    
    if (cmd == "查询") {
      Serial.println("设备状态：正常运行");
      Serial.println("温度：25.3℃");
    }
    else if (cmd == "开灯") {
      digitalWrite(LED_BUILTIN, HIGH);
      Serial.println("LED 已打开 ✓");
    }
    else if (cmd == "关灯") {
      digitalWrite(LED_BUILTIN, LOW);
      Serial.println("LED 已关闭 ✓");
    }
    else {
      Serial.println("错误：未知命令");
    }
  }
}
```

## 🚀 高级功能

### 自定义行尾符

根据设备需求选择合适的行尾符：

- **无**：不添加任何字符
- **换行 (\n)**：Unix/Linux 风格
- **回车 (\r)**：Mac OS 9 及更早版本
- **回车换行 (\r\n)**：Windows 风格（推荐，兼容性最好）

### 调整缓冲区大小

根据使用场景调整：

- **实时监控**：500-1000 行（减少内存占用）
- **长时间调试**：5000-10000 行（保留更多历史）
- **性能优先**：100-500 行（最快响应）

### 导出设备日志

1. 连接设备，开启自动滚动
2. 让设备运行一段时间
3. 选中所有文本（Ctrl+A）
4. 复制（Ctrl+C）
5. 粘贴到文本编辑器保存

## 📞 技术支持

如遇到问题：

1. 查看页面底部的诊断日志
2. 检查浏览器控制台（F12）的错误信息
3. 参考 [固件烧录功能_常见问题.md](./固件烧录功能_常见问题.md)
4. 联系技术支持

## 🔗 相关文档

- [固件烧录功能使用说明](./如何使用固件烧录功能.md)
- [固件烧录常见问题](./固件烧录功能_常见问题.md)
- [Web Serial API 文档](https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API)


