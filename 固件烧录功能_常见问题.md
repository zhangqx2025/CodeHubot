# å›ºä»¶çƒ§å½•åŠŸèƒ½ - å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

## âŒ é—®é¢˜ï¼šæç¤º"æµè§ˆå™¨ä¸æ”¯æŒ Web Serial API"

### é—®é¢˜åŸå› 

Web Serial API æ˜¯ä¸€ä¸ªéœ€è¦å®‰å…¨ä¸Šä¸‹æ–‡çš„æµè§ˆå™¨åŠŸèƒ½ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1. **å¿…é¡»ä½¿ç”¨ HTTPS åè®®**ï¼ˆæˆ– localhostï¼‰
2. **æµè§ˆå™¨ç‰ˆæœ¬è¦æ±‚**ï¼šChrome â‰¥ 89ã€Edge â‰¥ 89 æˆ– Opera
3. **ä¸èƒ½åœ¨ iframe ä¸­ä½¿ç”¨**

### æœ€å¸¸è§åŸå› ï¼šæ²¡æœ‰ä½¿ç”¨ HTTPS âš ï¸

å³ä½¿ä½ ä½¿ç”¨çš„æ˜¯ Chrome æµè§ˆå™¨ï¼Œå¦‚æœé€šè¿‡ HTTP è®¿é—®ç½‘ç«™ï¼ŒWeb Serial API ä¹Ÿ**ä¸ä¼šå¯ç”¨**ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šé…ç½® HTTPSï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

#### 1.1 ä½¿ç”¨ Nginx åå‘ä»£ç†é…ç½® HTTPS

ç¼–è¾‘ Nginx é…ç½®æ–‡ä»¶ï¼š

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;

    # SSL å®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://localhost:3000;  # å‰ç«¯æœåŠ¡
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api {
        proxy_pass http://localhost:8000;  # åç«¯æœåŠ¡
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTP è‡ªåŠ¨è·³è½¬ HTTPS
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

é‡å¯ Nginxï¼š

```bash
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl restart nginx
```

#### 1.2 è·å–å…è´¹ SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£… certbot
sudo apt install certbot python3-certbot-nginx  # Ubuntu/Debian
# æˆ–
sudo yum install certbot python3-certbot-nginx  # CentOS/RHEL

# è‡ªåŠ¨é…ç½® SSL
sudo certbot --nginx -d your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ localhostï¼ˆå¼€å‘ç¯å¢ƒï¼‰

å¦‚æœåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œç›´æ¥é€šè¿‡ `localhost` æˆ– `127.0.0.1` è®¿é—®å³å¯ï¼š

```
âœ… http://localhost:3000
âœ… http://127.0.0.1:3000
âŒ http://192.168.1.100:3000  ï¼ˆå±€åŸŸç½‘IPä¸è¡Œï¼‰
```

**æ³¨æ„**ï¼šå±€åŸŸç½‘ IPï¼ˆå¦‚ 192.168.x.xï¼‰éœ€è¦ä½¿ç”¨ HTTPSï¼

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

#### 3.1 ç”Ÿæˆè‡ªç­¾åè¯ä¹¦

```bash
# ç”Ÿæˆç§é’¥å’Œè¯ä¹¦
openssl req -x509 -newkey rsa:4096 -nodes \
  -keyout key.pem -out cert.pem -days 365 \
  -subj "/CN=localhost"
```

#### 3.2 é…ç½® Vite ä½¿ç”¨ HTTPSï¼ˆå‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼‰

ç¼–è¾‘ `vite.config.js`ï¼š

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import fs from 'fs'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  server: {
    https: {
      key: fs.readFileSync(path.resolve(__dirname, 'key.pem')),
      cert: fs.readFileSync(path.resolve(__dirname, 'cert.pem'))
    },
    port: 3000,
    host: '0.0.0.0'
  }
})
```

å¯åŠ¨åè®¿é—®ï¼š`https://localhost:3000`

**æ³¨æ„**ï¼šæµè§ˆå™¨ä¼šæç¤ºè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œç‚¹å‡»"ç»§ç»­è®¿é—®"æˆ–"æ¥å—é£é™©"å³å¯ã€‚

### æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ ngrokï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰

ngrok å¯ä»¥ä¸ºä½ çš„æœ¬åœ°æœåŠ¡åˆ›å»ºä¸€ä¸ªå…¬ç½‘ HTTPS åœ°å€ï¼š

```bash
# å®‰è£… ngrok
npm install -g ngrok
# æˆ–ä»å®˜ç½‘ä¸‹è½½ï¼šhttps://ngrok.com/download

# ä¸ºå‰ç«¯æœåŠ¡åˆ›å»º HTTPS éš§é“
ngrok http 3000
```

ngrok ä¼šç»™ä½ ä¸€ä¸ª HTTPS åœ°å€ï¼Œå¦‚ï¼š`https://abc123.ngrok.io`

## ğŸ” å¦‚ä½•æ£€æŸ¥å½“å‰é—®é¢˜

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æŒ‰ `F12` æˆ– `Ctrl+Shift+I`ï¼ˆMac: `Cmd+Option+I`ï¼‰

### 2. åœ¨ Console ä¸­æ‰§è¡Œ

```javascript
// æ£€æŸ¥æ˜¯å¦ä¸ºå®‰å…¨ä¸Šä¸‹æ–‡
console.log('å®‰å…¨ä¸Šä¸‹æ–‡:', window.isSecureContext);

// æ£€æŸ¥åè®®
console.log('å½“å‰åè®®:', window.location.protocol);

// æ£€æŸ¥ Web Serial API
console.log('Serial API:', 'serial' in navigator);
```

### 3. æŸ¥çœ‹ç»“æœ

```
âœ… æ­£å¸¸æƒ…å†µï¼š
   å®‰å…¨ä¸Šä¸‹æ–‡: true
   å½“å‰åè®®: https:
   Serial API: true

âŒ HTTP é—®é¢˜ï¼š
   å®‰å…¨ä¸Šä¸‹æ–‡: false
   å½“å‰åè®®: http:
   Serial API: false
```

## ğŸ“‹ æµè§ˆå™¨ç‰ˆæœ¬è¦æ±‚

| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | å‘å¸ƒæ—¥æœŸ |
|--------|---------|----------|
| Chrome | 89 | 2021å¹´3æœˆ |
| Edge | 89 | 2021å¹´3æœˆ |
| Opera | 75 | 2021å¹´3æœˆ |
| Firefox | âŒ ä¸æ”¯æŒ | - |
| Safari | âŒ ä¸æ”¯æŒ | - |

### æ£€æŸ¥ Chrome ç‰ˆæœ¬

1. åœ¨åœ°å€æ è¾“å…¥ï¼š`chrome://version/`
2. æŸ¥çœ‹ç‰ˆæœ¬å·ï¼ˆåº”è¯¥ â‰¥ 89ï¼‰

## ğŸ› ï¸ å¿«é€Ÿè¯Šæ–­è„šæœ¬

åˆ›å»ºä¸€ä¸ª HTML æ–‡ä»¶è¿›è¡Œè¯Šæ–­ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <title>Web Serial API è¯Šæ–­</title>
</head>
<body>
    <h1>Web Serial API è¯Šæ–­å·¥å…·</h1>
    <div id="result"></div>

    <script>
        const result = document.getElementById('result');
        const info = [];

        info.push(`<p><strong>å½“å‰åœ°å€ï¼š</strong>${window.location.href}</p>`);
        info.push(`<p><strong>åè®®ï¼š</strong>${window.location.protocol}</p>`);
        info.push(`<p><strong>ä¸»æœºï¼š</strong>${window.location.hostname}</p>`);
        info.push(`<p><strong>å®‰å…¨ä¸Šä¸‹æ–‡ï¼š</strong>${window.isSecureContext ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>`);
        info.push(`<p><strong>Web Serial APIï¼š</strong>${'serial' in navigator ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}</p>`);
        info.push(`<p><strong>æµè§ˆå™¨ï¼š</strong>${navigator.userAgent}</p>`);

        if (!window.isSecureContext) {
            info.push(`
                <div style="background: #fff3cd; padding: 15px; margin-top: 20px; border-left: 4px solid #ffc107;">
                    <h3 style="margin-top: 0; color: #856404;">âš ï¸ é—®é¢˜è¯Šæ–­</h3>
                    <p><strong>åŸå› ï¼š</strong>å½“å‰ä¸æ˜¯å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆé HTTPSï¼‰</p>
                    <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                    <ul>
                        <li>å¦‚æœåœ¨æœ¬åœ°ï¼šä½¿ç”¨ <code>localhost</code> æˆ– <code>127.0.0.1</code> è®¿é—®</li>
                        <li>å¦‚æœåœ¨æœåŠ¡å™¨ï¼šé…ç½® HTTPS è¯ä¹¦</li>
                    </ul>
                </div>
            `);
        } else if (!('serial' in navigator)) {
            info.push(`
                <div style="background: #f8d7da; padding: 15px; margin-top: 20px; border-left: 4px solid #dc3545;">
                    <h3 style="margin-top: 0; color: #721c24;">âŒ é—®é¢˜è¯Šæ–­</h3>
                    <p><strong>åŸå› ï¼š</strong>æµè§ˆå™¨ä¸æ”¯æŒ Web Serial API</p>
                    <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>ä½¿ç”¨ Chrome (â‰¥89)ã€Edge (â‰¥89) æˆ– Opera æµè§ˆå™¨</p>
                </div>
            `);
        } else {
            info.push(`
                <div style="background: #d4edda; padding: 15px; margin-top: 20px; border-left: 4px solid #28a745;">
                    <h3 style="margin-top: 0; color: #155724;">âœ… ä¸€åˆ‡æ­£å¸¸</h3>
                    <p>æ‚¨çš„æµè§ˆå™¨å’Œç¯å¢ƒæ”¯æŒ Web Serial APIï¼</p>
                </div>
            `);
        }

        result.innerHTML = info.join('');
    </script>
</body>
</html>
```

ä¿å­˜ä¸º `serial-check.html`ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å³å¯è¯Šæ–­ã€‚

## ğŸ“ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­ï¼š

1. è®¿é—®åœ°å€ï¼ˆå®Œæ•´ URLï¼‰
2. æµè§ˆå™¨ç‰ˆæœ¬ï¼ˆåœ¨åœ°å€æ è¾“å…¥ `chrome://version/`ï¼‰
3. æ“ä½œç³»ç»Ÿç‰ˆæœ¬
4. æ§åˆ¶å°é”™è¯¯ä¿¡æ¯æˆªå›¾
5. ä¸Šè¿°è¯Šæ–­è„šæœ¬çš„è¿è¡Œç»“æœ

## ğŸ”— å‚è€ƒèµ„æ–™

- [Web Serial API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API)
- [Secure Contexts - MDN](https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts)
- [Can I Use - Web Serial API](https://caniuse.com/web-serial)


