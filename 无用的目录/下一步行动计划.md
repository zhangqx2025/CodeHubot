# 📋 下一步行动计划

## 当前状态

### ✅ 已完成
1. **前端框架搭建** - `frontend/` 项目结构已创建
2. **后端部分整合** - 部分PBL功能已整合到backend：
   - ✅ courses.py - 课程管理API
   - ✅ device_pbl_authorizations.py - PBL设备授权API
   - ✅ course_model.py - 课程数据模型
   - ✅ pbl_group_device_authorization.py - 授权数据模型

### ⚠️ 待完成

#### 1. 后端整合（高优先级）⭐⭐⭐

**问题**：CodeHubot-PBL的后端API还没有完全整合到主backend

**检查点**：
```bash
ls CodeHubot-PBL/backend/app/api/endpoints/
```

**需要做的**：
1. 检查PBL后端还有哪些API没有整合
2. 将PBL的所有API整合到主backend的`app/api/`目录
3. 将PBL的models整合到主backend的`app/models/`
4. 将PBL的schemas整合到主backend的`app/schemas/`
5. 将PBL的services整合到主backend的`app/services/`
6. 更新`backend/app/api/__init__.py`注册所有PBL路由

#### 2. 前端代码迁移（高优先级）⭐⭐⭐

**问题**：frontend只是一个空壳，需要迁移真实代码

**需要做的**：

**Step 1: 迁移Device前端（自动）**
```bash
cd frontend
./migrate_code.sh
```

**Step 2: 迁移PBL前端（手动）**
需要从`CodeHubot-PBL/frontend/`迁移：
- 学生端页面和组件
- 教师端页面和组件
- 管理端页面和组件
- PBL特有的API封装
- PBL特有的工具函数

#### 3. 更新Docker配置（中优先级）⭐⭐

**需要更新**：
- `docker/docker-compose.prod.yml`
  - 将frontend服务替换为frontend
  - 移除frontend-pbl服务（如果有）
  - 配置环境变量

**示例配置**：
```yaml
services:
  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: codehubot-frontend
    ports:
      - "80:80"
    networks:
      - aiot-network
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped
```

#### 4. 环境变量配置（中优先级）⭐⭐

**backend环境变量**：
- SSO相关配置（如果需要）
- CORS配置（添加统一前端URL）

**frontend环境变量**：
- API基础URL
- 应用标题等

#### 5. 测试和验证（高优先级）⭐⭐⭐

**需要测试**：
- [ ] 后端API全部可用
- [ ] 前端登录功能
- [ ] 前端门户页面
- [ ] Device系统功能
- [ ] PBL学生端功能
- [ ] PBL教师端功能
- [ ] PBL管理端功能
- [ ] 跨模块跳转（Token共享）

---

## 🎯 推荐执行顺序

### 第一阶段：后端整合（重要！）

**为什么先做后端**：
- 前端依赖后端API
- 后端整合相对简单
- 可以先测试API再做前端

**步骤**：
1. 检查PBL后端还有哪些API
2. 运行或修改`integrate_pbl.sh`脚本
3. 手动整合缺失的API
4. 测试后端API
5. 更新API文档

**预计时间**：2-4小时

### 第二阶段：前端迁移（核心）

**Device前端迁移**：
```bash
cd frontend
./migrate_code.sh
```

**PBL前端迁移**：
手动复制和修改：
- 学生端views → `src/modules/pbl/student/views/`
- 教师端views → `src/modules/pbl/teacher/views/`
- 管理端views → `src/modules/pbl/admin/views/`
- 更新导入路径

**预计时间**：4-6小时

### 第三阶段：Docker配置（简单）

更新docker-compose.yml，配置环境变量

**预计时间**：30分钟

### 第四阶段：测试验证（重要）

全面测试所有功能

**预计时间**：2-3小时

---

## 📝 详细操作指南

### 操作1：检查PBL后端API（5分钟）

```bash
# 查看PBL后端有哪些API
ls -la CodeHubot-PBL/backend/app/api/endpoints/

# 对比主backend已有的API
ls -la backend/app/api/

# 找出缺失的API
```

### 操作2：整合PBL后端API（1-2小时）

**方案A：运行整合脚本**
```bash
./integrate_pbl.sh
```

**方案B：手动整合**（如果脚本有问题）
```bash
# 1. 复制API文件
cp CodeHubot-PBL/backend/app/api/endpoints/*.py backend/app/api/pbl/

# 2. 更新导入路径
# 将 from app.api.endpoints.xxx import yyy
# 改为 from app.api.pbl.xxx import yyy

# 3. 注册路由
# 在 backend/app/api/__init__.py 中添加PBL路由
```

### 操作3：迁移Device前端（30分钟）

```bash
cd frontend
./migrate_code.sh

# 检查迁移报告
cat MIGRATION_REPORT.md

# 测试
npm install
npm run dev
```

### 操作4：迁移PBL前端（2-3小时）

**学生端**：
```bash
# 复制views
cp -r CodeHubot-PBL/frontend/src/views/student/* \
      frontend/src/modules/pbl/student/views/

# 复制components
cp -r CodeHubot-PBL/frontend/src/components/student/* \
      frontend/src/modules/pbl/student/components/

# 更新导入路径（批量替换）
find frontend/src/modules/pbl/student -type f -name "*.vue" -exec sed -i '' 's|@/api|@shared/api|g' {} +
find frontend/src/modules/pbl/student -type f -name "*.vue" -exec sed -i '' 's|@/components|@pbl/student/components|g' {} +
```

重复类似步骤处理教师端和管理端。

### 操作5：更新路由配置（1小时）

在`frontend/src/router/pbl.js`中添加实际的路由：

```javascript
// PBL学生端路由
{
  path: '/pbl/student',
  component: () => import('@/layouts/PBLStudentLayout.vue'),
  meta: { requiresAuth: true, roles: ['pbl_student'] },
  children: [
    {
      path: 'courses',
      name: 'StudentCourses',
      component: () => import('@pbl/student/views/Courses.vue')
    },
    {
      path: 'tasks',
      name: 'StudentTasks',
      component: () => import('@pbl/student/views/Tasks.vue')
    },
    // ... 更多路由
  ]
}
```

### 操作6：更新Docker配置（30分钟）

编辑`docker/docker-compose.prod.yml`：

```yaml
services:
  # 移除或注释旧的frontend和frontend-pbl服务
  
  # 添加新的统一前端服务
  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: codehubot-frontend
    ports:
      - "80:80"
    networks:
      - aiot-network
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped

  backend:
    # 更新CORS配置
    environment:
      - CORS_ORIGINS=http://localhost:3000,http://your-domain.com
      # 其他环境变量...
```

### 操作7：测试（2-3小时）

```bash
# 1. 测试后端API
cd backend
python -m pytest tests/  # 如果有测试

# 手动测试API
curl http://localhost:8000/api/courses
curl http://localhost:8000/api/devices

# 2. 测试前端
cd frontend
npm run dev

# 访问 http://localhost:3000
# 测试登录
# 测试门户
# 测试各个系统
```

---

## 🎬 快速开始

### 我建议你现在立即做这个：

```bash
# 第1步：检查PBL后端API情况（5分钟）
cd /Users/zhangqixun/AICodeing/CodeHubot工作空间/CodeHubot
ls -la CodeHubot-PBL/backend/app/api/endpoints/
ls -la backend/app/api/

# 第2步：看看还需要整合哪些
# 告诉我结果，我帮你完成整合
```

---

## 📊 进度追踪

### 后端整合进度
- [ ] 检查PBL API完整性
- [ ] 整合缺失的API
- [ ] 整合缺失的models
- [ ] 整合缺失的schemas
- [ ] 整合缺失的services
- [ ] 注册所有路由
- [ ] 测试后端API
- [ ] 更新环境变量

### 前端整合进度
- [ ] 运行migrate_code.sh迁移Device
- [ ] 手动迁移PBL学生端
- [ ] 手动迁移PBL教师端
- [ ] 手动迁移PBL管理端
- [ ] 更新路由配置
- [ ] 更新导入路径
- [ ] 测试登录功能
- [ ] 测试门户功能
- [ ] 测试所有模块

### 部署配置进度
- [ ] 更新docker-compose.yml
- [ ] 配置环境变量
- [ ] 构建Docker镜像
- [ ] 测试Docker部署

---

## ❓ 你现在应该问自己

1. **PBL后端整合了多少？**
   - 运行：`ls CodeHubot-PBL/backend/app/api/endpoints/`
   - 对比：`ls backend/app/api/`
   - 找出缺失的API

2. **你想先做什么？**
   - 选项A：先完成后端整合
   - 选项B：先测试前端迁移脚本
   - 选项C：先更新Docker配置

3. **你有测试账号吗？**
   - Device系统的管理员账号
   - PBL系统的学生/教师/管理员账号

---

## 💡 我的建议

### 最优方案：

**第1天（4-6小时）**：
1. ✅ 检查并完成后端整合（2小时）
2. ✅ 运行前端迁移脚本（1小时）
3. ✅ 手动迁移PBL前端部分代码（2-3小时）

**第2天（3-4小时）**：
1. ✅ 完成PBL前端迁移（2小时）
2. ✅ 更新Docker配置（30分钟）
3. ✅ 全面测试（2小时）

**第3天（1-2小时）**：
1. ✅ 修复发现的Bug
2. ✅ 优化用户体验
3. ✅ 部署到生产环境

---

## 🎯 立即行动

**现在告诉我**：

1. 你想先完成哪个部分？
   - 后端整合？
   - 前端迁移？
   - 还是先测试现有功能？

2. 你需要我帮你做什么？
   - 检查PBL后端API？
   - 编写整合脚本？
   - 编写迁移指南？

**让我们开始吧！** 🚀
