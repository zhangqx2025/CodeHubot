# ==========================================
# CodeHubot 外部数据库模式配置示例
# 复制此文件为 .env 并修改相应配置
# ==========================================
# 
# 说明：此配置用于使用外部MySQL数据库的部署场景
# Docker容器只运行应用服务，不包含MySQL容器
#

# ==================== 外部数据库配置 ====================
# 外部MySQL数据库连接信息（必填）
EXTERNAL_DB_HOST=192.168.1.100
EXTERNAL_DB_PORT=3306
EXTERNAL_DB_USER=aiot_user
EXTERNAL_DB_PASSWORD=aiot_password
EXTERNAL_DB_NAME=aiot_admin

# ==================== Redis配置 ====================
REDIS_PORT=6379
REDIS_PASSWORD=

# ==================== MQTT配置 ====================
# MQTT Broker地址（可选，默认使用内部mqtt服务）
# 外部MQTT服务器示例：MQTT_BROKER=mqtt.example.com
MQTT_BROKER=mqtt
MQTT_PORT=1883
MQTT_WS_PORT=9001
MQTT_USERNAME=
MQTT_PASSWORD=

# ==================== 设备MQTT配置 ====================
# 提供给物联网设备连接的外部MQTT Broker地址
# ⚠️ 重要：这是告诉设备应该连接到哪个MQTT服务器
# 必须填写设备可以访问的外部地址（域名或公网IP）
# 示例：mqtt.example.com 或 192.168.1.100
DEVICE_MQTT_BROKER=mqtt.example.com
DEVICE_MQTT_PORT=1883
DEVICE_MQTT_USE_SSL=false

# ==================== 服务端口配置 ====================
BACKEND_PORT=8000
CONFIG_SERVICE_PORT=8001
FRONTEND_PORT=8080
FLOWER_PORT=5555
PLUGIN_SERVICE_PORT=9000

# ==================== 服务器配置 ====================
SERVER_BASE_URL=http://localhost:8000
BACKEND_URL=http://backend:8000

# ==================== JWT配置 ====================
# ⚠️ 生产环境必须修改此密钥！
# 生成方法：python3 -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-very-long-secret-key-at-least-32-characters-long
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=120
REFRESH_TOKEN_EXPIRE_MINUTES=10080

# ==================== 内部API密钥 ====================
# ⚠️ 生产环境必须修改此密钥！
# 生成方法：python3 -c "import secrets; print(secrets.token_urlsafe(32))"
INTERNAL_API_KEY=your-internal-api-key-change-me

# ==================== 阿里云服务配置 ====================
# 通义千问 API 密钥（用于知识库文档向量化）
# 获取方式：
#   1. 访问 https://dashscope.console.aliyun.com/
#   2. 登录阿里云账号，开通 DashScope 服务
#   3. 在 API-KEY 管理页面创建密钥
#   4. 复制密钥到下方（格式：sk-xxxxxxxxxxxxxxxxxxxxxxxx）
# 文档：https://help.aliyun.com/zh/dashscope/developer-reference/activate-dashscope-and-create-an-api-key
DASHSCOPE_API_KEY=sk-your-dashscope-api-key-here

# ==================== 阿里云VOD配置（视频点播，可选）====================
# 用于视频播放授权和观看次数限制功能
# 如不使用视频功能，可以不配置这些项
# 获取方式：登录阿里云控制台 -> AccessKey管理 -> 创建AccessKey
# 文档：https://help.aliyun.com/document_detail/61064.html
ALIYUN_ACCESS_KEY_ID=
ALIYUN_ACCESS_KEY_SECRET=
ALIYUN_VOD_REGION_ID=cn-shanghai

# ==================== 环境配置 ====================
ENVIRONMENT=production
LOG_LEVEL=INFO

# ==================== 插件服务配置 ====================
PLUGIN_CORS_ENABLED=true
PLUGIN_CORS_ORIGINS=*
PLUGIN_REQUEST_TIMEOUT=30
PLUGIN_DEBUG_MODE=false

# ==================== 构建加速配置（可选）====================
# 如果构建镜像时网络较慢，可以启用国内镜像源加速
# 设置为 true 使用清华大学镜像源，或使用自定义镜像源
USE_CHINA_MIRROR=true
# PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
# PIP_TRUSTED_HOST=pypi.tuna.tsinghua.edu.cn

# ==================== 管理员账号配置（首次部署推荐）====================
# 系统启动时会自动创建管理员账号（如果设置了 ADMIN_PASSWORD）
# 如果账号已存在，则不会重复创建

# 管理员用户名（默认：admin）
ADMIN_USERNAME=admin

# 管理员密码（必须设置才会创建管理员账号）
# 建议使用强密码，至少8位，包含字母和数字
ADMIN_PASSWORD=

# 管理员邮箱（可选，默认：{ADMIN_USERNAME}@aiot.com）
# ADMIN_EMAIL=admin@example.com

# ==================== 默认大模型配置（首次部署推荐）====================
# 系统启动时会自动创建默认的通义千问大模型配置
# 如果未配置，智能体将无法使用（除非手动创建大模型配置）

# 通义千问API密钥
# QWEN_API_KEY=sk-your-qwen-api-key-here

# 通义千问API地址（默认：https://dashscope.aliyuncs.com/compatible-mode/v1）
# QWEN_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1

# 模型名称（默认：qwen-turbo）
# QWEN_MODEL_NAME=qwen-turbo

# 显示名称（默认：通义千问-Turbo）
# QWEN_DISPLAY_NAME=通义千问-Turbo

# 最大token数（默认：8192）
# QWEN_MAX_TOKENS=8192

# 温度参数（默认：0.20）
# QWEN_TEMPERATURE=0.20

# Top-p参数（默认：0.90）
# QWEN_TOP_P=0.90

# ==================== 默认产品配置（首次部署推荐）====================
# 系统启动时会自动创建默认的产品配置（ESP32-S3开发板）
# 如果未配置，将使用默认值

# 产品编码（默认：ESP-32-S3-01）
# DEFAULT_PRODUCT_CODE=ESP-32-S3-01

# 产品名称（默认：标准开发板）
# DEFAULT_PRODUCT_NAME=标准开发板

# ==================== Flower监控配置 ====================
# Flower任务监控面板的访问认证
# 格式：用户名:密码
FLOWER_BASIC_AUTH=admin:admin

# ==========================================
# 🚀 快速启动指南（外部数据库模式）
# ==========================================
# 1. 准备外部MySQL数据库：
#    - 确保MySQL服务正在运行（5.7或8.0版本）
#    - 创建数据库：CREATE DATABASE aiot_admin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
#    - 创建用户并授权：
#      CREATE USER 'aiot_user'@'%' IDENTIFIED BY 'aiot_password';
#      GRANT ALL PRIVILEGES ON aiot_admin.* TO 'aiot_user'@'%';
#      FLUSH PRIVILEGES;
#    - 导入数据库结构：mysql -h HOST -u aiot_user -p aiot_admin < SQL/init_database.sql
#
# 2. 复制并配置环境变量：
#    cp docker/.env.external-db.example docker/.env
#    编辑 docker/.env，修改以下配置：
#    - EXTERNAL_DB_HOST（外部MySQL主机地址）
#    - EXTERNAL_DB_PORT（外部MySQL端口，默认3306）
#    - EXTERNAL_DB_USER（数据库用户名）
#    - EXTERNAL_DB_PASSWORD（数据库密码）
#    - EXTERNAL_DB_NAME（数据库名称）
#    - DEVICE_MQTT_BROKER（设备连接的MQTT地址，必填！）
#    - SECRET_KEY（生产环境必须修改！）
#    - INTERNAL_API_KEY（生产环境必须修改！）
#    - DASHSCOPE_API_KEY（如需使用知识库向量化功能）
#    - ADMIN_PASSWORD（首次部署建议设置，自动创建管理员账号）
#
# 3. 使用部署脚本启动（推荐）：
#    ./deploy.sh deploy-external-db
#
# 4. 或手动启动服务：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml up -d
#
# 5. 查看服务状态：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml ps
#
# 6. 查看日志：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml logs -f [服务名]
#
# 服务访问地址：
#   - 前端：http://localhost:80（或配置的FRONTEND_PORT）
#   - 后端API：http://localhost:8000
#   - API文档：http://localhost:8000/docs
#   - Celery监控：http://localhost:5555/flower
#   - 插件服务：http://localhost:9000
#   - 配置服务：http://localhost:8001
#
# ==========================================
